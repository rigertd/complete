/**
 * @file This file contains the functions and symbols required by the login
 *       and sign-up forms for the Baby Growth Tracker website.
 * @author David Rigert [rigertd@onid.oregonstate.edu]
 * @copyright 2015 David Rigert
 */
if(typeof GrowthTracker=="undefined"){var GrowthTracker={};}if(typeof GrowthTracker.SignUp=="undefined"){GrowthTracker.SignUp={emailAvailable:true};}if(typeof GrowthTracker.Login=="undefined"){GrowthTracker.Login={};}window.onload=function(){var n=document.getElementById("signup_first");var k=document.getElementById("signup_last");var i=document.getElementById("signup_email");var l=document.getElementById("signup_password1");var m=document.getElementById("signup_password2");var h=document.getElementById("signup_button");var j=document.getElementById("login_button");n.onblur=GrowthTracker.validateElement;k.onblur=GrowthTracker.validateElement;i.onblur=function(){if(GrowthTracker.validateElement(i)){GrowthTracker.SignUp.checkEmail();}};l.onblur=GrowthTracker.validateElement;m.onkeyup=GrowthTracker.SignUp.validatePassword;h.onclick=function(){return GrowthTracker.validateForm("signup")&&GrowthTracker.SignUp.validatePassword()&&GrowthTracker.SignUp.emailAvailable;};j.onclick=function(){return GrowthTracker.validateForm("login")&&GrowthTracker.Login.authenticate();};};GrowthTracker.SignUp.checkEmail=function(){var d=document.getElementById("signup_email");var f=new XMLHttpRequest();var e="login.php?action=email&signup_email="+encodeURIComponent(d.value);if(!GrowthTracker.validateElement(d)){return false;}f.onreadystatechange=function(){if(this.readyState===4){var a=this.responseText;if(a==="false"){GrowthTracker.hideError(d);GrowthTracker.SignUp.emailAvailable=true;GrowthTracker.removeValidationMessage("emailInUse");}else{GrowthTracker.showError(d);GrowthTracker.SignUp.emailAvailable=false;GrowthTracker.addValidationMessage("emailInUse","That e-mail address is already in use.");}}};f.open("GET",e);f.send();};GrowthTracker.Login.authenticate=function(){var l=document.getElementById("login");var h=document.getElementById("email");var m=document.getElementById("password");var n=document.getElementById("login_button");var j=new XMLHttpRequest();var i="login.php";var k="action=auth&email="+encodeURIComponent(h.value)+"&password="+encodeURIComponent(m.value);j.onreadystatechange=function(){if(this.readyState===4){n.disabled=false;var a=this.responseText;if(a==="true"){l.submit();}else{alert("Invalid login credentials");GrowthTracker.clearForm(l);}}};n.disabled=true;j.open("POST",i);j.setRequestHeader("Content-type","application/x-www-form-urlencoded");j.setRequestHeader("Content-length",String(k.length));j.setRequestHeader("Connection","close");j.send(k);return false;};GrowthTracker.SignUp.validatePassword=function(){var c=document.getElementById("signup_password1");var d=document.getElementById("signup_password2");if(c.value&&c.value.substring(0,d.value.length)!=d.value){GrowthTracker.showError(d);GrowthTracker.addValidationMessage("pwMatch","The passwords do not match.");return false;}else{GrowthTracker.hideError(d);GrowthTracker.removeValidationMessage("pwMatch");return true;}};